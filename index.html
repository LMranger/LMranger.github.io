<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="高雄輕軌成圓抽獎查詢，無須在FB中茫茫比對，僅需輸入卡片末四碼便能查詢中獎資訊。">
    <title>高雄輕軌成圓抽獎查詢</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <h1>高雄輕軌成圓抽獎查詢</h1>
    <p>這是方便查詢<a href="https://www.krtc.com.tw/Information/events_more?id=3180004f1e03493bbd5cdb260968753c" target="_blank">高雄輕軌成圓</a>中獎的簡易網站</p>
    <p>請輸入卡片末四碼以查詢是否中獎：</p>
    <input type="text" id="card_last_four" placeholder="電子票證末四碼">
    <button onclick="checkWinner()">查詢</button>
    <p id="result"></p>
    <p id="version"></p>
    <p>官方連結： <a href="https://www.krtc.com.tw/Information/events_more?id=3180004f1e03493bbd5cdb260968753c">輕軌抽獎官網</a></p>
    <p><small>By Daniel and assisted by AI</small></p>

    <script>
        function checkWinner() {
            var cardLastFour = document.getElementById('card_last_four').value;
            if (!validateInput(cardLastFour)) {
                document.getElementById('result').innerText = '請輸入四位有效數字！';
                return;
            }
            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'winners.json', true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    var data = JSON.parse(xhr.responseText);
                    var winners = data.winners;
                    var version = data.version;
                    var weeks = data.weeks;
                    var matchingWinners = winners.filter(function(winner) {
                        return winner.card_last_four === cardLastFour;
                    });
                    if (matchingWinners.length > 0) {
                        var resultHtml = '您可能中獎了！請核對完整卡號：<br><br>';
                        matchingWinners.forEach(function(winner) {
                            var weekIndex = winner.week - 1;
                            var weekNumber = weeks[weekIndex].week_number;
                            var facebookLink = weeks[weekIndex].facebook_link;
                            var fullCardNumber = winner.full_card_number;
                            var prize = winner.prize;
                            resultHtml += ''
                                + weekNumber + ': <strong>' + fullCardNumber + '</strong>' + '<a href=facebookLink target="_blank"> (FB公告)</a><br>' 
                                + '-' + prize + '<br>'
                                + '<br>';
                        });
                        document.getElementById('result').innerHTML = resultHtml;
                    } else {
                        document.getElementById('result').innerText = '抱歉，您沒有中獎。';
                    }
                    // 在結果後顯示版本號
                    document.getElementById('version').innerText = '目前名單更新至第 ' + version + ' 週';
                }
            };
            xhr.send();
        }


        function validateInput(input) {
            return /^\d{4}$/.test(input);
        }

        // 監聽 Enter 鍵事件
        document.getElementById('card_last_four').addEventListener('keyup', function(event) {
            if (event.key === 'Enter') {
                checkWinner();
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>抽獎查詢</title>
</head>
<body>
    <h1>抽獎查詢</h1>
    <p>請輸入卡片末四碼以查詢是否中獎：</p>
    <input type="text" id="card_last_four">
    <button onclick="checkWinner()">查詢</button>
    <p id="result"></p>
    <p id="version"></p>

    <script>
        function checkWinner() {
            var cardLastFour = document.getElementById('card_last_four').value;
            var xhr = new XMLHttpRequest();
            xhr.open('GET', 'winners.json', true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    var data = JSON.parse(xhr.responseText);
                    var winners = data.winners;
                    var version = data.version;
                    var weeks = data.weeks;
                    var isWinner = false;
                    var prize = '';
                    var weekNumber = '';
                    var facebookLink = '';
                    for (var i = 0; i < winners.length; i++) {
                        if (winners[i].card_last_four === cardLastFour) {
                            isWinner = true;
                            prize = winners[i].prize;
                            var weekIndex = winners[i].week - 1;
                            weekNumber = weeks[weekIndex].week_number;
                            facebookLink = weeks[weekIndex].facebook_link;
                            break;
                        }
                    }
                    if (isWinner) {
                        document.getElementById('result').innerHTML = '恭喜！您中獎了！獎品是：' + prize + '，周次：<a href="' + facebookLink + '" target="_blank">' + weekNumber + '</a>';
                    } else {
                        document.getElementById('result').innerText = '抱歉，您沒有中獎。';
                    }

                    // 在結果後顯示版本號
                    document.getElementById('version').innerText = '目前名單更新至第 ' + version + ' 版';
                }
            };
            xhr.send();
        }
    </script>
</body>
</html>
